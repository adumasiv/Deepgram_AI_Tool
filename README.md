# Audio Model Benchmarking Tool

## üìå Purpose

This application provides analysts with a user-friendly interface for benchmarking Text-to-Speech (TTS) audio models. Analysts can:

- Select TTS models from a dropdown menu.
- Listen to audio samples generated by those models.
- Provide feedback using:
  - **Predefined tags** (set by admins with database access).
  - **0‚Äì10 rating system**.
- Save results to a database for efficient grouping and performance analysis.

The tool supports secure user authentication, local or remote database connections, and a scalable architecture for future enhancements.

---

## ‚öôÔ∏è Setup Instructions

### 1. Authentication

This application uses **Google OAuth** for authentication.

1. Create a project at the [Google Cloud Console](https://console.cloud.google.com).
2. Enable the necessary APIs, create credentials, and configure access scopes.  
   Reference: [Google OAuth 2.0 Guide](https://developers.google.com/identity/protocols/oauth2/web-server).
3. For **local development**, use:
   - **Authorized JavaScript Origins**:
     ```
     http://localhost:3000
     http://localhost
     ```
   - **Redirect URI**:
     ```
     http://localhost:5000/api/auth/signin-google/callback
     ```
4. For production deployment, replace `localhost` with your frontend and backend URLs.

---

### 2. Server Setup

- **Recommended Python Version**: `3.10.12`.
- Create a **Python virtual environment**.
- Navigate to the `/server` directory:
  ```bash
  pip install -r requirements.txt
  ```
- Create a `.env` file in `/server` based on the template in `serverenv.txt`.
- Start the server:
  ```bash
  python3 server.py
  ```

---

### 3. Client Setup

- Create a `.env` file in `/client` based on `clientenv.txt`.
- Install dependencies:
  ```bash
  npm install
  ```
- **Run development build**:
  ```bash
  npm start
  ```
- **Create production build**:
  ```bash
  npm run build
  ```
  This generates a `build/` folder that can be served by your own backend.

---

### 4. Database Setup

The initial build uses **PostgreSQL** with four main tables:

```sql
-- Tags available to analysts
CREATE TABLE tags (
    tag VARCHAR(50) PRIMARY KEY
);

-- Available TTS models
CREATE TABLE models (
    name VARCHAR(50) PRIMARY KEY
);

-- Audio file metadata and binary data
CREATE TABLE audio (
    id SERIAL PRIMARY KEY,
    model VARCHAR(30) NOT NULL,
    tier VARCHAR(30),
    language VARCHAR(30),
    text VARCHAR(200),
    audiofile BYTEA NOT NULL
);

-- Analyst feedback on audio samples
CREATE TABLE tagging (
    email VARCHAR(100),
    timestamp TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    audioid INT REFERENCES audio(id),
    tags TEXT[],
    score INT,
    quantifier VARCHAR(30),
    PRIMARY KEY (email, timestamp)
);
```

**Notes:**
- `score = -1` is the default if no rating is given.
- `quantifier` defaults to an empty string.
- `audioid` links to the `audio` table for data grouping.

---

## üîÆ Future Development

**Server:**
- Replace local file-based storage with your own database backend in `storage_util.py`.
- Optimize `create_model_data` for efficiency when querying large datasets.
- Consider moving audio file storage from Flask sessions to a dedicated database table.

**Client:**
- Support quantifier integration when server logic is implemented.
- Modify text display logic in `TextContainer` if model texts differ.

---

## üõ† Common Troubleshooting

| Issue | Likely Cause | Solution |
|-------|--------------|----------|
| **Site cannot be reached after login** | Incorrect frontend/backend URL in `.env` | Verify `.env` settings |
| **WebSocket error on Mac** | Port 3000 conflict | Change frontend dev port |
| **OAuth Error 401: invalid_client** | Invalid Google client ID/secret | Verify in `.env` and Google Console |
| **JSONDecodeError on login** | Invalid Google discovery URL | Check `.env` |
| **Null map() error in TTSTool** | Database connection or table missing | Verify `.env` DB settings |
| **Missing Python modules** | Python version mismatch | Use Python `3.10.12` |
| **Text/quantifier not displaying** | `.env` client settings disabled | Enable in `.env` |
| **Cleanup function runs twice** | `debug=True` in `server.py` | Set to `False` in production |


